---
title: "Mass Shootings in the USA"
author: "Hannah Reitz & Sophie Hensgen"
header-includes:
    - \usepackage{setspace}\doublespacing
    - \usepackage{booktabs}
    - \usepackage{longtable}
    - \usepackage{floatrow}
    - \floatsetup[table]{capposition=top}
date: "`r Sys.Date()`"
output:
  pdf_document:
    toc: yes
    df_print: kable
always_allow_html: true
#bibliography: Mass_Shootings.bibtex
---

```{r, include = FALSE}
library(openxlsx)
library(xml2)
library(rvest)
library(jsonlite)
library(robotstxt)
library(RSocrata)
library(dplyr)
library(rlist)
library(pipeR)
library(gtrendsR)
library(lubridate)
library(writexl)
library(readxl)
library(tidyverse)
library(magrittr)
library(broom)
library(knitr)
library(ggplot2)
library(ggpubr)
library(systemfonts)
library(ggiraph)
library(devtools)
library(ggiraphExtra)
library(jtools)
library(broom.mixed)
library(stargazer)
library(ggstance)
library(stargazer)
library(summarytools)


#devtools::install_github('davidgohel/ggiraph')
```


Citation examples for in-text citations:

Smith cited [@smith04].
Smith cited without author [-@smith04].
@smith04 cited in line.

# Introduction

On february 14th 2018 the Parkland High school shooting took place and with it one of the largest gun control movements emerged. 
At this incident a former student of the Marjory Stoneman Douglas High School killed 17 people and injured another 17 with a rifle. The event was heavily covered by multiple news outlets and became the subject of a heated discussion about stricter gun laws in the US. One month later on march 24th there were nation wide protest called "March for Our Lives", led by the students in cooperation with the non-profit organization Never Again MSD, which demand stricter gun laws. 
It is not the first time, that a mass shooting started a discussion about gun regulations. Other shootings like the Sandy Hook Elementary School shooting in 2012 or the Orlando Nightclub shooting in 2016 brought the topic up as well. A study showed, that media coverage regarding gun regulation increase after a mass shooting occurs, the following Media Coverage and the general attention on this topic can have a positive influence. For example, after the Parkland shooting Florida raised the minimum age for buying a rifle from 18 to 21 years.

However it depends heavily on the parties which are in control to this particular time. @lucaetal16 found evidence that in the year after a large mass shooting happened, the republican are more likely to loosen the gun laws Instead of making them more strict.

In general, the US has a long history of school and mass shootings, in 2019 alone there were 417 mass shootings, which fall under the definition as follows: "incidents in which four or more persons are murdered within a 24 hour period" [@Duwe2000, p. 323]. Many of which got little to no media attention. One possible reason why smaller shootings gather less media coverage and therefore are brought less to our attention is because there are less exciting, nothing special and therefore would not sell as good as other stories. And even if covered, after a certain amount of time, a new event occurs and will overshadow the previous news. This does not only apply to news outlets, also people in general are drawn to prominent issues and exciting events. If there are no new information coming or more specifically people have seen enough of a topic and become fatique. In the following graph we can observe such a loos in interest. 

This graph displays the relation of Search Hits for each keyword in comparison to the general frequency in which they are searched prior to the event period. We included the Sandy Hook shooting, which had 28 Deaths and the Clackamas shooting which had 4 Deaths. The x axis describes the period we want to look at, from one day prior to the event (Day 1), the event day (Day 2) and two weeks following the event date (Days 3-16). The y-axis shows the related search hits for each keyword. Unfortunately we cannot make any emphases about the general attention both events achieved, as we do not have access to the total numbers of hits. However, we can see a clear difference in the search behavior. The Sandy Hook shooting got more hits on the actual event day and also lost interest much slower than the Clackamas shooting did. The Clackamas shooting got a spike in attention around one day after the event and drops rapidly on the second day after the shooting. 





```{r include = FALSE}
sandy <- gtrends(c("Sandy Hook shooting"), geo = "US", time = "2012-12-13 2012-12-28", low_search_volume = T)
clack <- gtrends(c("Clackamas shooting"), geo = "US", time = "2012-12-10 2012-12-25", low_search_volume = T)
plot(sandy)
plot(clack)
sandyI <- sandy$interest_over_time
clackI <- clack$interest_over_time
example <- rbind(sandyI, clackI)

example <- as_tibble(example)
glimpse(example)

example$rownumber <- rep(c(1:16), times=2)

example

# Aufbereitung
example$hits <- gsub("<1", "0", example$hits, fixed = TRUE)
example$hits <- as.numeric(as.character(example$hits))
```

```{r echo = FALSE}
# Plot
ggplot(example, aes(x = rownumber, y = hits, col = keyword))+
  geom_line()+
  theme(
  panel.background = element_rect(fill = "white", colour = "white",
                                size = 1, linetype = "solid"),
  panel.grid.major = element_line(size = 0.5, linetype = 'solid',
                                colour = "white"), 
  panel.grid.minor = element_line(size = 0.25, linetype = 'solid',
                                colour = "white")
  )+
  labs(title = "Google Trend Example", subtitle = "Sandy Hook Elementary School Shooting & Clackamas Town Center shooting", x = "Days", y = "Search Hits", colour = "Keyword")+
  scale_x_continuous(breaks = round(seq(min(example$rownumber), max(example$rownumber), by = 1),1)) 
```

As we can see, there seems to be differences in the interest of people regarding mass shootings. With our study we want to focus on the people`s interest and these differences and less about the media itself.  

# Lit Rev & Theory and Hypotheses

In september 1949 one of the first publicly known mass shootings took place, which was later k and since then hundrets followed
Kleine Einleitung in Literature Review:

"Like acts of terrorism and mass murder, not all mass shootings receive equitable media coverage,
despite the sensational nature of the phenomenon as a whole (Schildkraut 2014, 2016). Absent from
the body of research, however, is an exploration as to why this coverage is disparate" Schildkraut 2018 p. 224


In order to understand why people tend to concentrate on more salient events we have to look into some theories which explain this circumstance.

## Issue-Attention-Cycle

As we mentioned before, the media has a great impact on the information we consume. It dictates what will appear on our TV Screen or our newspaper. However, this is not a one way relation. The media also depends on what people want to see, which is something new, never heard before. People tend to get bored easily, even if a continuous problem occurs on their radar, after a while they strive for something new. Therefore, news outlets have to be careful on what they are reporting in order to maintain their listeners. 

But why do people loose their interest in topics, even if they are still prominent? @Downs72 a Issue-Attention-Cycle could answer this question. This cycle has five stages which I will explain this by using the Parkland shooting. 
First, the pre problem stage, the stage in which the problem already exists, however there is less to no attention on it at the moment. One of the prior problem of our example is the high death rate by gun and the easy access to highly lethal weapons. 
Second, the alarmed discovery and euphoric enthusiasm, which occurs after (a series of) event(s). In this period of time multiple things will happen. News outlets will heavily cover the event(s), people will then form a unit to solve the problem. However, most of those problems cannot be solved in a short period of time, like the high gun death rate. There has to changes in the government but also within the society. 
Which brings us to our third stage, realizing the costs of solving the problem. The initial euphoria and drive will vanish and will be replaced by the reality of the sacrifices a large amount of people has to do in order to solve the problem. Even though our example has two clear sides (pro gun control and pro gun possession), both sides will come across costs in order to solve the initial problem. Pro gun possession side would have to give up the easy access to rifles and the pro gun regulation side has to stay relevant, they need the attention in order to create pressure towards the government, which is done by protests and online presence. 
However, the fourth stage will diminish this. After the realization there will be a gradual decline of interest in this topic. Less news coverage and therefore less attention of people in general. People will feel fatique as their optimism will decrease with every person who gives up.
And ultimately will end in the fifth stage the post problem area. This stage is not to be confused with the first stage (pre problem), even though there will be less to no focus on the problem, during the stages could have build organizations and laws could be enacted which will remain. For example, after the Parkland shooting occurred there where changes in gun laws in Florida, which is an achievement itself. Nevertheless it was not the ultimate goal of the movement. 
To sum up, even though the ultimate goal was not achieved, media attention and therefore public attention can have a great influence in solving problems in their society. However, the event has to be large enough in order to start an issue-attention cycle. If not, the interest will be diminish even faster or will not be addressed at all, we will touch on this later on.


## Moral Panic theory

Not all mass shootings will live through the whole issue-attention cycle, moreover some mass shootings will loose the attention as fast as they gained it. Not because people realize how hard it would be to make a change in order to solve the problem, but because other events will occurre which are more interesting. 
The moral panic theory describes this phenomenon, it has a similar structure if compared to the issue-attention cycle, however, it is much more ephemeral. Moral panics are short lived, intense media coverage will appear shortly after an event occurred (similar to the issue-attention cycle), but diminish almost as fast as they occurred. Events have to be "triggering, focussing & defining" in a certain way to gain the amount of media coverage [cite!], only then people will engage in it. However, this event will be replaced after only few days. Most moral panics will peak in their first two days, after 5 to 6 days they're disappeared. Some moral panics can become routinized or institutionalized [cite!!], but most of them won't.


## Salience of events - newsworthiness

The most newsworthy events are events that are highly salient. But what do we perceive as highly salient? It has to be something that does not happen often, a rare event. If we remember back to the beginning of the paper, we mentioned, that 417 shootings occurred in 2019, only some were featured in the news. That's because they are not newsworthy enough. The media would overflow the public with these shootings, sooner or later no one would read these articles anymore, as it would feel repetitive. So they feature only the exceptional events. 
Another important aspect is, that it has to be quite big and attention seeking. An event that is maybe rare but small, will not get the same attention as a huge event would. For example, it is rather rare that a mass shooting is done by a women, which is a rare event in itself, however if she would only shot four people it would not get the same attention if any as if she shoot more. 
And even if these aspects are fulfilled, it does not mean, that the event will be covered by the news as intensely as others because of the following reasons. First, if it is a problem by a minority it will be less salient and therefore less likely to be broadcasted. Second, if the problems which occurred give significant benefit to the majority or a powerful minority (e.g. pro gun allience) it will be less salient. And third, the event gave light to a problem, that has no (longer) intrinsically existing qualities. 

## Theory 

As we can see, there are several aspects which come into account when talking about salience and newsworthiness. There has to be a prior problem, the event has to be salient enough (an rare and great event) in order gain attention and also be important for the entire population, not only for a minority. In consideration of all these aspects we came up with the following diagram: 


We would like to investigate the influence of certain characteristic of mass shootings on the interest of the population. On basis of the moral panic theory and the issue-attention cycle we theorize that certain aspects will gain more attention because of their salience level, which will lead to a presumably higher and more permanent media coverage. Through the increased media coverage, there should follow a general increase in the interest of the population on this specific event, which should in turn result in a slower decline of the Google trend curve. 


## Hypotheses

@Schildkraut et al examined several potential aspects of mass shooting that could lead to increased media coverage. These include the ethnicity of the predator, the survival of the redactor, gender of the predator, location and the victim count. He found evidence that increased media coverage would be induced if the predator would be non-white, would survive or if there were a high number of victims. The latter is particularly interesting for our first two hypotheses. We argue, that because of the increased salience caused by a high number of victims, the media coverage will drastically increase which will in turn result in a gentle decrease of search hits compared to less media covered shootings. 


Based on the research of @Schildkrautetal and other researchers who found similar results regarding media coverage of mass shootings [@Sung-Yeon12], we came up with the following hypotheses: 

*H1: The more people got injured during a massshooting, the decline in the relative count of search hits on the event will be less steep.*

*H2: The more people died during a massshooting, the decline in the relative count of search hits on the event will be less steep.*


Generally, research indicates that news coverage particularly is skewed toward stories about crime Schildkraut p. 223

The first two hypotheses mainly focus on how certain crimes in this case mass shootings garner more attention from the media because they are more "newsworthy" [@someauthors]. We argued that the more people died or got injured during a mass shooting the more newsworthy the event is and the more the media reports about it. In turn this high media attention leads to an increase in public interest and the decline of search hits in Google trends on this mass shooting is less steep than for mass shootings that are not as newsworthy, do not get reported on as heavily and do not accumulate as much public interest. The next three hypotheses concentrate more on specific characteristics of mass shootings and how those could affect the decline of the relative count of search hits on this event in Google.

First, the racial or ethnic identity of the perpetrator might be an important characteristic to consider as this could heavily shape the way media presents mass shootings and the ensuing public interest in the events. Mainstream media targets mostly the white middle class in th US as the goal is to reach a larch audience. Because of this most media outlets report from a white perspective and thus "non-whites are more likely to be portrayed in a negative light relative to whites" [@Callanan2012, p. 94]  [@Tukachinsky2015, p. 187; @Wheeler2017, p. 73]. Therefore, a selection bias in media reporting in relation to race exists. Previous studies show that race explains some of the selection bias in the media. If the perpetrator in a mass shooting is not white or from another ethnicity than the majority population, the media covers the event more extensively [citations] Lundman

In line with these findings, we suggest that as non-white violators in mass shootings attract more attention from the media, this might lead to a higher interest in the event by the public. In light of the present study this higher interest in mass shootings committed by non-white violators by the broad public may manifest in a decline in hits on Google that is less steep than for events with white shooters. Hence, we expect that if the shooter is non-white or has a migration background, the decline in the relative count of search hits on the event is less steep. The third hypothesis, therefore, is:

*H3: If the shooter is black or has a migration-background, the decline in the relative count of search hits on the event is less steep.*

Another important characteristic to explain why the public interest declines slower for some mass shootings but not for others is the affluence of the area in which the shooting happens. There is not much research on the relationship between the Affluence of the area in which a mass shooting takes place and the media coverage it receives yet. However, the study by [-@Schildkraut2018, p. 235] shows that  shootings that happen in more affluent communities receive more attention from newspapers. Accordingly, we assume that mass shootings in more affluent communities are more  newsworthy and thus draw more media attention. Subsequently, the public interest in these shootings is greater and the reduction of the relative search hit count is less steep than for shootings that happen in less affluent communities. Therefore, the fourth hypothesis is:

*H4: The more affluent a community a mass shooting happens in is, the shallower is the reduction of the relative search hit count.*

As for the last hypothesis there is sparse research on how the gun laws of the state a mass shooting happens in influence its newsworthiness, media coverage and how this might affect the public interest. We expect that if a mass shooting happens in a state with weak gun laws the issue of gun control becomes more salient. Subsequently in light of this public discussion the event becomes more newsworthy and the media covers the shooting more heavily. Because of this, the public interest in the mass shooting rises and the relative count of the search hits on Google declines slower. Hence, the fifth hypothesis is:

*H5: If the state a mass shooting happens in has weak gun laws, the relative count of the search hits on Google declines slower.*

In summary, most of the previous research on mass shootings mainly focused on how certain characteristics of shootings affect its newsworthiness and its coverage in the media. Our contribution to this literature is to consider how certain characteristics of mass shootings could influence the public interest in form of the temporal decline in the relative count of search hits on this event on Google (bessere Formulierung?). Additionally we also consider characteristics of mass shootings previous studies have not considered. The focus of past research was mainly on the impact the count of dead and injured persons as well as the race of the perpetrator have on the media reporting. We also take into account how the affluence of the community where a shooting happens and the strength of the gun laws in the state a shooting takes place affect the public interest in the event. 


# Data and Variables

In order to analyze our hypotheses we combine data from Wikipedia that includes general information on mass shotings in the US with Google Trends data on the relative number of searches on Google for each event. A regression of the independent variables stated in the hypotheses on the decline of the relative search hit count on Google is conducted. This process is explained in detail in the following.

## Data from Wikipedia

First, we scraped all tables from the Wikipedia page on mass shootings in the US which are available from 2000 to 2020 [@wiki] and cleaned the data from unnecessary information. Then the scraped tables were joined into one data set and all columns that include missings were dropped as we cannot include them in a regression. The resulting table includes information about the date, the location, the count of dead persons, the count of injured persons, the total number of dead and injured persons and a description for each massshooting. 

Because we are using the data set based on the information from wikipedia later on to scrape data from google trends we created additional variables. We generated a variable with the dates fourteen days after the date of the mass shooting. This variable was subsequently used to create another variable which included both, the date of the mass shooting and the date fourteen days after the mass shooting in the required style of the Google Trends API. Furthermore, we generated a variable for the search term the Google Trends API is using to find information on the relative count of hits this keyword received in the 15 days time period. We conducted a manual search on Google Trends to find the search term for each event that received the highest number of hits in the 15 days time span for each event. Moreover, we discarded the years 2000, 2001, 2002 and 2003 as it is not possible to scrape Google Trends data before the year 2004.

After exporting this data table to excel we added three variables with information on the ethnicity of the shooter, the affluence of the area/community a shooting happened at and the strength of the gun laws for the state in which a shooting happened. These variable represent the indpendendent variables for the regression models in the analysis section additionally to the count of dead and injured persons. In order to find the necessary information on these characteristics, a online search was executed. The information on the ethnicity of the perpetrator was found on the respective Wikipedia page for each mass shooting. The variable was coded 0 if the shooter was black or had a migration background and 1 for white US Americans. The affluence of the community a mass shootings happened in was determined by a chart that depicts how the US Census Bureau breaks down income levels [@income].  .................... to be continued

Erlärung welche Daten, wie gescrapt, wie sehen die Daten aus Deskription
Tabelle mit für Missing, welche observations haben wir warum gedropped, wie viele observations verbleiben in unserem sample --> timeperiods droppen.


```{r Scraping of Wikipedia tables, results="hide"}
url <- "https://en.wikipedia.org/wiki/List_of_mass_shootings_in_the_United_States"
t <- read_html(url)
table <- t %>% html_nodes("#mw-content-text > div > table") %>% html_table(trim=T)
```

```{r, include = FALSE}
table
```

```{r, include = FALSE}
### Data editing

# Removing unnecessary expressions

for (i in 1:10) {
   table[[i]]$Injured <- gsub("[n 1]", "", table[[i]]$Injured, fixed = TRUE)
   table[[i]]$Injured <- gsub("[n 2]", "", table[[i]]$Injured, fixed = TRUE)
   table[[i]]$Injured <- gsub("[n 3]", "", table[[i]]$Injured, fixed = TRUE)
   table[[i]]$Injured <- gsub("[n 4]", "", table[[i]]$Injured, fixed = TRUE)
   table[[i]]$Injured <- gsub("[n 5]", "", table[[i]]$Injured, fixed = TRUE)
   table[[i]]$Injured <- gsub("[n 6]", "", table[[i]]$Injured, fixed = TRUE)
   table[[i]]$Injured <- gsub("[n 7]", "", table[[i]]$Injured, fixed = TRUE)
   table[[i]]$Injured <- gsub("[n 8]", "", table[[i]]$Injured, fixed = TRUE)
   table[[i]]$Injured <- gsub("[n 9]", "", table[[i]]$Injured, fixed = TRUE)
   table[[i]]$Injured <- gsub("+", "", table[[i]]$Injured, fixed = TRUE)
   table[[i]]$Dead <- gsub("[n 1]", "", table[[i]]$Dead, fixed = TRUE)
   table[[i]]$Dead <- gsub("[n 2]", "", table[[i]]$Dead, fixed = TRUE)
   table[[i]]$Dead <- gsub("[n 3]", "", table[[i]]$Dead, fixed = TRUE)
   table[[i]]$Dead <- gsub("[n 4]", "", table[[i]]$Dead, fixed = TRUE)
   table[[i]]$Dead <- gsub("[n 5]", "", table[[i]]$Dead, fixed = TRUE)
   table[[i]]$Dead <- gsub("[n 6]", "", table[[i]]$Dead, fixed = TRUE)
   table[[i]]$Dead <- gsub("[n 7]", "", table[[i]]$Dead, fixed = TRUE)
   table[[i]]$Dead <- gsub("[n 8]", "", table[[i]]$Dead, fixed = TRUE)
   table[[i]]$Dead <- gsub("[n 9]", "", table[[i]]$Dead, fixed = TRUE)
   table[[i]]$Dead <- gsub("+", "", table[[i]]$Dead, fixed = TRUE)
   table[[i]]$Total <- gsub("+", "", table[[i]]$Total, fixed = TRUE)
}


# Storing Injured, Dead and Total as numerics

for (i in 1:10) {
  as.numeric(as.character(table[[i]]$Injured))
  as.numeric(as.character(table[[i]]$Dead))
  as.numeric(as.character(table[[i]]$Total))
}


# Joining all tables to one data frame

newtab <- table[[1]]

for (i in 1:10) {
  newtab <- newtab %>% full_join(table[[i]], by = c("Date", "Location", "Dead", "Injured", "Total", "Description"))
}

newtab

# Change Date structure

str(newtab$Date)

for (i in 1:10) {
   newtab$Date <- gsub(" ", "-", newtab$Date, fixed = TRUE)
   newtab$Date <- gsub(",", "", newtab$Date, fixed = TRUE)
}

newtab

#Extract only the name of the shooting of off the Description, delete everything else

newtab$Description <- sub(":.*$", "", newtab$Description)
newtab
```


```{r, include = FALSE}

# save Date as date format

lct <- Sys.getlocale("LC_TIME"); Sys.setlocale("LC_TIME", "C")
newtab[["Date"]] <- as.Date(newtab$Date, format = "%B-%d-%Y")
newtab

# Create new Variable for the Timespan

newtab$After <- newtab$Date + 14
newtab

# delete NAs

newtab <- na.omit(newtab)

# Correct the order of the variables

newtab <- newtab[, c("Date", "After", "Location", "Dead", "Injured", "Total", "Description")] 
newtab

# Create a new Variable for the Timespan --> TrendPeriod
newtab$TrendPeriod <- paste(newtab$Date, newtab$After)
newtab

```

Erwähnen, dass wir nur nach einem Begriff suchen
Search Terms verglichen bei Trends 
Alle Events, die über Tage gehen gedropped
Sophie: 6-10 subben
Hannah: 11-15 

```{r, include = FALSE}
### Data Editing 

newtab$SearchTerm <- gsub("shootout", "shooting", newtab$Description, fixed = TRUE)

# Correct the order of the variables

newtab <- newtab[, c("Date", "After", "TrendPeriod", "SearchTerm", "Description", "Location", "Dead", "Injured", "Total")] 

# delete the number in the searchterm
number <- c("2004", "2005", "2006", "2007", "2008", "2009", "2010", "2011", "2012", "2013", "2014", "2015", "2016", "2017", "2018", "2019")

as.character(number)

for (i in number){
   newtab$SearchTerm <- gsub(i , "", newtab$SearchTerm, fixed = TRUE)
}

# Change SearchTerm so that it does find the most Hits

newtab$SearchTerm <- gsub(" at Charlotte", "", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub("January ", "", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub(", ", " ", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub("shootings", "shooting", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub("attack", "shooting", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub("Shooting of Jemel Roberson", "Jemel Roberson shooting", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub("Fifth Third Center shooting", "Cincinatti shooting", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub("Jacksonville Landing shooting", "Jacksonville shooting", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub("Art All Night shooting", "Trenton shooting", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub("Copper Canyon Apartment Homes shooting", "Highlands Ranch shooting", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub("Rancho Tehama Reserve shooting", "Tehama shooting", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub("Sutherland Springs church shooting", "Sutherland Springs shooting", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub("Burnette Chapel shooting", "Antioch shooting", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub("Clovis library shooting", "Clovis shooting", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub("Little Rock nightclub shooting", "Little Rock shooting", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub("Bronx-Lebanon Hospital shooting", "Bronx shooting", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub("San Francisco UPS shooting", "San Francisco shooting", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub("Congressional baseball shooting", "Alexandria shooting", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub("Eaton Township Weis Markets shooting", "Weis Markets shooting", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub("Sandy Utah shooting", "Sandy shooting", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub("Orlando factory shooting", "Orlando shooting", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub("North Park Elementary School shooting", "North Park shooting", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub("Cincinnati nightclub shooting", "Cincinnati shooting", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub("Schofield/Rothschild shooting", "Rothschild shooting", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub("Fort Lauderdale airport shooting", "Fort Lauderdale shooting", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub("Townville Elementary School shooting", "Townville shooting", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub("Citronelle homicides", "Citronelle shooting", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub("shooting of Baton Rouge police officers", "Baton Rouge shooting", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub("St. Joseph courthouse shooting", "Courthouse shooting", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub("shooting of Dallas police officers", "Dallas shooting", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub("Orlando nightclub shooting", "Orlando shooting", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub("Wilkinsburg mass shooting", "Wilkinsburg shooting", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub("Colorado Springs Planned Parenthood shooting", "Planned Parenthood shooting", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub("Shooting of protesters at a Black Lives Matter protest", "Minneapolis shooting", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub("Umpqua Community College shooting", "Roseburg shooting", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub("Murders of Alison Parker and Adam Ward", "Roanoke shooting", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub("Charleston church shooting", "Charleston shooting", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub("Rosemary Anderson High School shooting", "Portland shooting", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub("Marysville Pilchuck High School shooting", "Marysville shooting", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub("Isla Vista killings", "Isla Vista shooting", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub("Ross Township Municipal Building shooting", "Ross Township shooting", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub("South Valley homicides", "South Valley shooting", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub("Sandy Hook Elementary School ()", "Sandy Hook shooting", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub("Clackamas Town Center shooting", "Clackamas shooting", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub("Azana Spa shooting", "Brookfield shooting", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub("Wisconsin Sikh temple shooting", "Oak Creek shooting", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub("Aurora Colorado movie theater shooting", "Aurora shooting", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub("Seattle cafe shooting spree", "Seattle shooting", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub("Chardon High School shooting", "Chardon School shooting", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub("Southern California Edison shooting", "Edison shooting", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub("Carson City IHOP shooting", "Carson shooting", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub("Copley Township shooting", "Copley shooting", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub("Grand Rapids mass murder", "Grand Rapids shooting", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub("Safeway Shooting in Casas Adobes Arizona ()", "Tucson shooting", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub("Hartford Beer Distributors shooting", "Manchester shooting", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub("University of Alabama in Huntsville shooting", "University of Alabama shooting", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub("ABB plant shooting", "St Louis shooting", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub("Fort Hood Military Base shooting", "Fort Hood shooting", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub("Shooting of Pittsburgh Police Officers", "Pittsburgh shooting", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub("New York immigration center shooting", "Binghampton shooting", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub("Carthage nursing home shooting", "Carthage shooting", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub("Geneva County massacre", "Geneva shooting", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub("Covina massacre", "Covina shooting", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub("Skagit County Shooting Spree ()", "Skagit Shooting", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub("Northern Illinois University shooting", "Illinois shooting", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub("Kirkwood City Council shooting", "Kirkwood shooting", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub("Lane Bryant shooting", "Tinley Park shooting", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub("Youth with a Mission and New Life Church shooting", "Colorado shooting", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub("Westroads Mall shooting ()", "Omaha shooting", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub("Crandon Wisconsin duplex shooting ()", "Crandon shooting", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub("West Nickel Mines School shooting", "Bart shooting", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub("Seattle Jewish Federation shooting", "Seattle shooting", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub("Capitol Hill massacre", "Seattle shooting", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub("Goleta postal facility shooting", "Goleta shooting", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub("Tacoma Mall shooting", "Tacoma shooting", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub("Red Lake Indian Reservation shooting", "Red Lake shooting", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub("Columbus nightclub shooting", "Columbus shooting", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub("Hunting Trip ()", "Meteor shooting", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub("Wesson family murders", "Fresno shooting", newtab$SearchTerm, fixed = TRUE)

newtab <- newtab[format(newtab$Date,'%Y') != "2003", ]
newtab <- newtab[format(newtab$Date,'%Y') != "2002", ]
newtab <- newtab[format(newtab$Date,'%Y') != "2001", ]
newtab <- newtab[format(newtab$Date,'%Y') != "2000", ]

newtab


```
Delisle tripple murder droppen -->> nicht genug daten
Bart shooting evtl. rausnehmen --> sieht aus als hätte es sehr kleine Fallzahlen und einen seltsamen Verlauf
Meteor shooting sieht komish aus --> evtl droppen wegen kleiner Fallzahl

```{r, include = FALSE}
# Exporting data frame to excel in order to add further variables

#Pfad Hannah
#write_xlsx(newtab,"C:\\Users\\hre\\Documents\\Uni_Mannheim\\FSS_2020\\Research_Methods_Fundamentals_of_Computing_and_Data_Display\\Paper\\Term-Paper-Fundamentals\\Fundamentals---Term-Paper-\\wikishootings2.xlsx")

#Pfad Sophie
#write_xlsx(newtab,"/Users/sophiehensgen/Term-Paper-Fundamentals/Fundamentals---Term-Paper-/WikiShootingscomplete.xlsx")
```

```{r, include = FALSE}
# Inporting excel Data 

wikishooting <- read_excel("WikiShootings_final.xlsx")
wikishooting

```

```{r, include = FALSE}
### Data edditing

# correcting Data types

wikishooting[["Date"]] <- as.Date(wikishooting$Date, format = "%Y-%m-%d")
wikishooting[["After"]] <- as.Date(wikishooting$Date, format = "%Y-%m-%d")

wikishooting

# dropping NAs

wikishooting$Ethnicity[wikishooting$Ethnicity == "NA"] <- NA
wikishooting <- na.omit(wikishooting)

# correcting Data types

wikishooting$Ethnicity <- as.numeric(wikishooting$Ethnicity)

wikishooting$TrendPeriod <- gsub("2008-12-24 2009-01-07", "2008-12-24 2009-01-21", wikishooting$TrendPeriod, fixed = TRUE)

# Drop Haynie family as it does not give any results/hits
wikishooting <-
  wikishooting %>%
  filter(SearchTerm != "Shooting of Haynie family")

wikishooting

```

############################################################################################################################################
############################################################################################################################################
############################################################################################################################################

## Data from GTrends


```{r, include = FALSE}
#Versuch eines Loop der einzelne outcomes speichert

#listshooting <- list()
#for (i in 1:nrow(wikishooting)){
#    x <- as.vector(wikishooting$SearchTerm[i])
#    y <- as.vector(wikishooting$TrendPeriod[i])
#    shooting <- gtrends(keyword = x, geo = "US", time = y, low_search_volume = T)
#    iteration <- (1 + length(listshooting))
#    listshooting[[iteration]] <- shooting
# }



# Beispiel wie man die einzelnen Tabellen verbindet

#massshooting <- listshooting[[1]]$interest_over_time
#for (i in 2:length(listshooting)){
#    shoot <- listshooting[[i]]$interest_over_time
#    massshooting <- rbind(massshooting, shoot)
#}
#massshooting

#saveRDS(massshooting, "massshooting.rds")

# Load the city object as city
gtrends <- readRDS("massshooting.rds")
gtrends

```

First, we transform the `data.frame` into a `tibble`.

```{r, include = FALSE}
### Data editing

# Some shootings have the same search term, so we add here the Date in order to recognize them latter on

gtrends <- as_tibble(gtrends)
glimpse(gtrends)


gtrends$keyword <- ifelse(gtrends$time == "2004-03-12 2004-03-26", 
                             gsub("Fresno shooting", "Fresno shooting 2004", gtrends$keyword, fixed = TRUE),
                             gtrends$keyword)

gtrends$keyword <- ifelse(gtrends$time == "2019-11-17 2019-12-01", 
                             gsub("Fresno shooting", "Fresno shooting 2019", gtrends$keyword, fixed = TRUE),
                             gtrends$keyword)

gtrends$keyword <- ifelse(gtrends$time == "2006-03-25 2006-04-08", 
                             gsub("Seattle shooting", "Seattle shooting March 2006", gtrends$keyword, fixed = TRUE),
                             gtrends$keyword)

gtrends$keyword <- ifelse(gtrends$time == "2006-07-28 2006-08-11", 
                             gsub("Seattle shooting", "Seattle shooting July 2006", gtrends$keyword, fixed = TRUE),
                             gtrends$keyword)

gtrends$keyword <- ifelse(gtrends$time == "2012-05-30 2012-06-13", 
                             gsub("Seattle shooting", "Seattle shooting July 2012", gtrends$keyword, fixed = TRUE),
                             gtrends$keyword)

gtrends$keyword <- ifelse(gtrends$time == "2009-11-05 2009-11-19", 
                             gsub("Fort Hood shooting", "Fort Hood shooting 2009", gtrends$keyword, fixed = TRUE),
                             gtrends$keyword)

gtrends$keyword <- ifelse(gtrends$time == "2014-04-02 2014-04-16", 
                             gsub("Fort Hood shooting", "Fort Hood shooting 2014", gtrends$keyword, fixed = TRUE),
                             gtrends$keyword)

gtrends$keyword <- ifelse(gtrends$time == "2017-03-26 2017-04-09", 
                             gsub("Cincinnati shooting", "Cincinnati shooting 2017", gtrends$keyword, fixed = TRUE),
                             gtrends$keyword)

gtrends$keyword <- ifelse(gtrends$time == "2018-09-06 2018-09-20", 
                             gsub("Cincinnati shooting", "Cincinnati shooting 2018", gtrends$keyword, fixed = TRUE),
                             gtrends$keyword)

gtrends$keyword <- ifelse(gtrends$time == "2014-07-09 2014-07-23", 
                             gsub("Harris County shooting", "Harris County shooting 2014", gtrends$keyword, fixed = TRUE),
                             gtrends$keyword)

gtrends$keyword <- ifelse(gtrends$time == "2015-08-08 2015-08-22", 
                             gsub("Harris County shooting", "Harris County shooting 2015", gtrends$keyword, fixed = TRUE),
                             gtrends$keyword)

gtrends$keyword <- ifelse(gtrends$time == "2016-06-12 2016-06-26", 
                             gsub("Orlando shooting", "Orlando shooting 2016", gtrends$keyword, fixed = TRUE),
                             gtrends$keyword)

gtrends$keyword <- ifelse(gtrends$time == "2017-06-05 2017-06-19", 
                             gsub("Orlando shooting", "Orlando shooting 2017", gtrends$keyword, fixed = TRUE),
                             gtrends$keyword)

# change smaller than 1 to 0 to make sure, that we do not get any NAs because of them

gtrends$hits <- gsub("<1", "0", gtrends$hits, fixed = TRUE)

# covina Shooting had to have a larger Time period, here we correct it. So does it fits with the others

gtrends <- gtrends[-c(271:284), ]

gtrends


```

############################################################################################################################################
############################################################################################################################################
############################################################################################################################################


## Method 

Due to the Google Trend data and its structure, we are not able to investigate the true frequencies of Google searches. However, as we focus on the descent of interest for each shooting we will take a different approach. In order to inspect the decline of interest we created linear regressions for each individual shooting using the Google Trend data set we created prior. For each regression we use as dependent variable the search hits in relation and as independent variable the days we inspect, from one day prior to the shooting till two weeks after it happened (15 days). The resulting coefficient for each shooting represents the decline in interest of the population and can be used further as a new variable in our data set. We then include the new variable into the data set with our Wikipedia Data. For our further investigation we will concentrate on the new expanded Wikipedia data set. The new variable is used as the new dependent variable in our final linear regression. The independent variables are the number of deaths, number of injured people, area in which it happened, the gun laws in the area of the shooting and the ethnicity od the predator.

```{r, include = FALSE}
# give every shooting a countdown with 1 to 15, for each day we inspect

gtrends$rownumber <-  rep(c(1:15), times=131)
gtrends

# save the hits as numeric values
gtrends$hits <- as.numeric(as.character(gtrends$hits))

# regression for each mass shooting 
```

```{r, results="hide"}
reg <-
  gtrends %>%
  group_by(keyword) %>%           
  do(tidy(lm(hits ~ rownumber, data=.)))
```

```{r, include = FALSE}
reg 


# subset the reg
reg <- subset(reg, term=="rownumber")

reg

#write_xlsx(reg,"C:\\Users\\hre\\Documents\\Uni_Mannheim\\FSS_2020\\Research_Methods_Fundamentals_of_Computing_and_Data_Display\\Paper\\Term-Paper-Fundamentals\\Fundamentals---Term-Paper-\\reg.xlsx")

gtrends

wikishooting <-
  wikishooting %>%
  arrange(SearchTerm)

wikishooting

#write_xlsx(wikishooting,"C:\\Users\\hre\\Documents\\Uni_Mannheim\\FSS_2020\\Research_Methods_Fundamentals_of_Computing_and_Data_Display\\Paper\\Term-Paper-Fundamentals\\Fundamentals---Term-Paper-\\wikialph.xlsx")

Final <- cbind(wikishooting, coef = reg$estimate) 

Final
```

############################################################################################################################################
############################################################################################################################################
############################################################################################################################################

# Results


```{r, include = FALSE}

# Converting variables needed for bar plots into character vectors

Final$Ethnicity <- as.character(Final$Ethnicity)

Final$Area <- as.character(Final$Area)

Final$Gunlaws <- as.character(Final$Gunlaws)
Final

# Boxplots of metric variables (Dead, Injured)

boxdead <- 
  ggplot(Final) +
  labs(title = "Dead Persons", x = "", y = "Count") +
  geom_boxplot(mapping = aes(x = "Dead", y = Dead)) +
  theme(plot.title = element_text(size = 10.5),
        axis.title.y = element_text(size = 10.5),
        axis.text.y = element_text(size=8.5),
        axis.text.x = element_blank(), 
        axis.ticks.x = element_blank()) +
 # theme(
  #axis.text.y = element_blank()) + #,
 # axis.ticks.y = element_blank()) +
  coord_cartesian(ylim = c(0, 20)) 
 # scale_y_continuous(breaks=seq(0,15,5)) 
  #coord_flip()
boxdead

boxinjured <- 
  ggplot(Final) +
  labs(title = "Injured Persons", x = "", y = "Count") +
  geom_boxplot(mapping = aes(x = "Injured", y = Injured)) +
  theme(plot.title = element_text(size = 10.5),
        axis.title.y = element_text(size = 10.5),
        axis.text.y = element_text(size=8.5),
        axis.text.x = element_blank(), 
        axis.ticks.x = element_blank()) +
 # scale_y_continuous(limits = quantile(Final$Injured, c(0.1, 0.9))) +
 # theme(
 # axis.text.y = element_blank(), +
 # axis.ticks.y = element_blank()) +
 # scale_y_continuous(breaks=seq(0,500,20)) +
  coord_cartesian(ylim = c(0, 20)) 
  #coord_flip()
boxinjured


# Barplots of categorical variables (Dead, Injured)

## Ethnicity

bareth <- ggplot(Final, aes(x = Ethnicity)) +
  geom_bar(mapping = aes(y = ..prop.., group = 1), stat = "count") +
  labs(title = "Ethnicity", x = "", y = "Relative Frequencies") +
  theme(plot.title = element_text(size = 10.5),
        axis.title.y = element_text(size = 10.5),
        axis.text.x = element_text(size=7.5),
        axis.text.y = element_text(size=8)) +
  scale_x_discrete(labels=c("0" =  "Black or Other Ethnicity", "1" = "White American")) +
  scale_y_continuous(labels = scales::percent_format(), limit = c(0, 1.0)) +
  geom_text(aes(label = scales::percent((..count..)/sum(..count..)),
            y= ((..count..)/sum(..count..))), stat="count", size = 3, vjust = -.5) 
bareth


## Area

bararea <- ggplot(Final, aes(x = Area)) + 
  geom_bar(mapping = aes(y = ..prop.., group = 1), stat = "count") +
  labs(title = "Affluence of Community", x = "", y = "Relative Frequencies") +
  theme(plot.title = element_text(size = 10.5),
        axis.title.y = element_text(size = 10.5),
        axis.text.x = element_text(size=7.5),
        axis.text.y = element_text(size=8)) +
  scale_x_discrete(labels=c("0" =  "Low Income Community", "1" = "High Income Community")) +
  scale_y_continuous(labels = scales::percent_format(), limit = c(0, 1.0)) +
  geom_text(aes(label = scales::percent((..count..)/sum(..count..)),
            y= ((..count..)/sum(..count..))), stat="count", size = 3, vjust = -.5) 
bararea


## Gunlaws
bargun <- ggplot(Final, aes(x = Gunlaws)) + 
  geom_bar(mapping = aes(y = ..prop.., group = 1), stat = "count") +
  labs(title = "Gun Law Strength", x = "", y = "Relative Frequencies") +
  theme(plot.title = element_text(size = 10.5),
        axis.title.y = element_text(size = 10.5),
        axis.text.x = element_text(size=7.5),
        axis.text.y = element_text(size=8)) +
  scale_x_discrete(labels=c("0" =  "Weak Gun Laws", "1" = "Strong Gun Laws")) +
  scale_y_continuous(labels = scales::percent_format(), limit = c(0, 1.0)) +
  geom_text(aes(label = scales::percent((..count..)/sum(..count..)),
            y= ((..count..)/sum(..count..))), stat="count", size = 3, vjust = -.5) 
bargun

```


```{r, echo = FALSE}
barplots <- ggarrange(bareth, bararea, bargun,   #+ rremove("x.text"), 
          #labels = c("A", "B", "C"),
          ncol = 2, nrow = 2)
annotate_figure(barplots,
               top = text_grob("Figure 1: Barplots of Categorical Variables with Frequencies and Shares in Percent", color = "black", face = "bold", size = 11), 
               #fig.lab = "Figure 1", fig.lab.face = "bold"
               )

```


```{r, echo = FALSE}
boxplots <- ggarrange(boxdead, boxinjured,   #+ rremove("x.text"), 
          #labels = c("A", "B", "C"),
          ncol = 2, nrow = 1)
annotate_figure(boxplots,
               top = text_grob("Figure 2: Boxplots of Metric Variables", color = "black", face = "bold", size = 11)
               #fig.lab = "Figure 2", fig.lab.face = "bold"
               )

```


```{r, include = FALSE}
# Tabels with descriptive statistics of independent variables

st_options(freq.cumul = FALSE)

descmetric <-
  Final %>%
  select(c(Dead, Injured)) %>%
  descr(.,stats = c("mean", "sd"), transpose = TRUE, headings = FALSE) 
descmetric

desccat <-
  Final %>%
  select(c(Ethnicity, Area, Gunlaws)) %>%
  freq(., plain.ascii=FALSE, cumul = FALSE, report.nas = FALSE, totals = FALSE, headings = FALSE)
desccat

```


```{r echo=FALSE}
# Tabels with descriptive statistics of independent variables

stargazer(Final[c("Dead","Injured")], type = "text", title="Descriptive statistics of metric variables", summary.stat = c("n", "median", "sd", "min", "max"))

#stargazer(Final[c("Ethnicity","Area", "Gunlaws")], type = "text", title="Descriptive statistics of categorical variables")

#desccat <-
#  Final %>%
#  select(c(Ethnicity, Area, Gunlaws)) %>%
#  freq(., plain.ascii=FALSE, cumul = FALSE, report.nas = FALSE, totals = FALSE, headings = FALSE)
#desccat
```


Hannah: Descriptives: Barplots of variables mit facet wrap wewe
##########################################################


Wie sollten vllt. Gender of shooter kontrollieren. Frauen werden in den Medien mehr beachtet --> Könnte zu einer Verzerrung der Ergebnisse führen.



Hannah: Coefplot oder Marginsplot für volles Modell
############################################

```{r, include = FALSE}
# Regression 

regdead <- lm(coef ~ Dead, data = Final, )

reginjured <- lm(coef ~ Injured, data = Final, )

regeth <- lm(coef ~ Ethnicity, data = Final, )

reggun <- lm(coef ~ Gunlaws, data = Final, )

regarea <- lm(coef ~ Area, data = Final, )

regfull <-  lm(coef ~ Dead + Injured + Ethnicity + Area + Gunlaws, data = Final, )
```

```{r, results='asis'}
# PDF Table of regressions
stargazer::stargazer(regdead, reginjured, regeth, reggun, regarea, regfull, 
                     title   = "These are awesome results!", 
                     covariate.labels = c("Dead", "Injured", "Ethnicity","Area", "Gunlaws"), 
                     dep.var.labels   = "decrease of interest", 
                     keep.stat = c("adj.rsq", "n"),
                     flip = TRUE)
```

Sophie: Plot Regressionsgeraden des vollen Modells
##########################################

```{r include=FALSE}
# simple predict plot for the first to hypotheses

scatdead <- ggPredict(regdead,se=TRUE,interactive=FALSE)
scatinjured <- ggPredict(reginjured,se=TRUE,interactive=FALSE)
scatarea <- ggPredict(regarea, se=TRUE,interactive=FALSE)
scatgunlaw <- ggPredict(reggun, se=TRUE,interactive=FALSE)
scatethnic <- ggPredict(regeth, se=TRUE,interactive=FALSE)
```

```{r include=FALSE}
scatterplots1 <- ggarrange(scatdead, scatinjured,  
          ncol = 2, nrow = 1)
scatterplots2 <- ggarrange(scatarea, scatgunlaw, scatethnic, 
          ncol = 2, nrow = 2)


```

```{r echo=FALSE}
annotate_figure(scatterplots1,
               top = text_grob(label = "Figure 3: predicted scatterplots of the regression", color = "black", face = "plain", size = 11), 
               #fig.lab = "Figure 1", fig.lab.face = "bold"
               )

annotate_figure(scatterplots2,
               top = text_grob(label = NULL, color = "black", face = "plain", size = 11), 
               #fig.lab = "Figure 1", fig.lab.face = "bold"
               )
```

```{r echo=FALSE}
coefplot <- plot_coefs(regarea, regeth, reggun, reginjured, regdead, regfull, scale = TRUE, inner_ci_level = .9, colors = "Set3")

annotate_figure(coefplot,
               top = text_grob(label = "Figure 4: Coefissionplot on every regression model ", color = "black", face = "plain", size = 11), 
               #fig.lab = "Figure 1", fig.lab.face = "bold"
               )

plot_summs(regarea, regeth, reggun, reginjured, regdead, regfull, scale = TRUE, inner_ci_level = .9, colors = "Set3")

# durch integrieren von allen Variablen in das Model entfernen sie sich von der MItte.
```

Hannah Ab Regression Table 








Hannah Ab Regression Table 




# Conclusion 
Hannah


# References


# Appendix

```{r, include = FALSE}
# Tabels with descriptive statistics of independent variables

#library(summarytools)
#st_options(freq.cumul = FALSE)

#descmetric <-
#  Final %>%
#  select(c(Dead, Injured)) %>%
#  descr(.,stats = c("mean", "sd"), transpose = TRUE, headings = FALSE) 
#descmetric

#desccat <-
#  Final %>%
#  select(c(Ethnicity, Area, Gunlaws)) %>%
#  freq(., plain.ascii=FALSE, cumul = FALSE, report.nas = FALSE, totals = FALSE, headings = FALSE)
#desccat

```



```{r results = 'asis'}
# Tabels with descriptive statistics of independent variables

#stargazer::stargazer(Final[c("Dead","Injured")], type = "text", title="Descriptive statistics of metric variables", summary.stat = c("n", "mean", "sd", "min", "max"))

stargazer(Final[c("Dead","Injured")], title="Descriptive statistics of metric variables", summary.stat = c("n", "median", "sd", "min", "max"), table.layout ="=n")

library(sjmisc)
library(papeR)


Final$Ethnicity <- as.factor(Final$Ethnicity)
Final$Ethnicity <- factor(Final$Ethnicity,
levels = c(0, 1),
labels = c("Black or Other Ethnicity", "White American")) 

Final$Area <- as.factor(Final$Area)
Final$Area <- factor(Final$Area,
levels = c(0, 1),
labels = c("Low Income Community", "High Income Community")) 

#Final
#Final$Ethnicity <- as.factor(Final$Ethnicity)

#summarize(Final, type = "factor", variables = "Ethnicity")


print(xtable::xtable(summarize(Final, caption = "My Title", type = "factor", variables = c("Ethnicity", "Area"), caption.placement = "top")))





```




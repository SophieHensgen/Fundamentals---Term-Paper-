---
title: "Mass Shootings in the USA"
author: "Hannah Reitz & Sophie Hensgen"
header-includes:
    - \usepackage{setspace}\doublespacing
date: "`r Sys.Date()`"
output:
  pdf_document:
    toc: yes
    df_print: kable
#bibliography: Mass_Shootings.bibtex
---
lala
```{r, include = FALSE}
library(openxlsx)
library(xml2)
library(rvest)
library(jsonlite)
library(robotstxt)
library(RSocrata)
library(dplyr)
library(rlist)
library(pipeR)
library(gtrendsR)
library(lubridate)
library(writexl)
library(readxl)
library(tidyverse)
library(magrittr)
library(broom)
library(knitr)

```

dfjhv
Citation examples for in-text citations:

Smith cited [@smith04].
Smith cited without author [-@smith04].
@smith04 cited in line.

# Introduction

Aufhänger: Many studies about media salience of mass shootings, but no research about how this media attention influences peoples' interest in certain events. 

Based on previous definition of mass murder (citations from Duwe 2000, p.373) mass shootings in this paper are defined as "incidents in which four or more persons are murdered within a 24 hour period" [@Duwe2000, p. 323] with a gun.

Sophie: Grafik von zwei Kurven, die möglichst unterschiedlich sind

# Theory and Hypotheses

Kleine Einleitung in Literature Review:

"Like acts of terrorism and mass murder, not all mass shootings receive equitable media coverage,
despite the sensational nature of the phenomenon as a whole (Schildkraut 2014, 2016). Absent from
the body of research, however, is an exploration as to why this coverage is disparate" Schildkraut 2018 p. 224




Wie können wir einen Graphen einbinden/erstellen der unsere Zusammenhänge illustriert: 

Deaths/Injuries/Race of perpetrator/  ----->    The decline of the search interest
Rich area/ Loose gun control                    in google trends is slower
          I                                            /\
           I                                          I
            I                                        I
             V                                      I
        more media attention for a 
        longer time span due to more  --->     More people notice the  
        newsworthiness of event                event in media reports



More dead people --> more media attention --> higher attention in Google trends

newworthiness in den Medien

Könntest du evtl. gebrauchen:
"Because agenda-setting theory is applicable at both the issue and attribute levels,17
media coverage of school shootings can be analyzed at these two levels as well.
Although no particular theory was mentioned in it, a study examining the salience of
fourteen school shooting incidents in network television news can be considered an
example of issue agenda-setting research.18 By measuring the amount of news coverage
of the incidents, the researchers showed that shooting incidents that resulted in
more deaths or greater injuries were covered more. They also found that the amount
of coverage was highly correlated across major television networks, demonstrating
their “herd mentality.” Sung-Yeon Park (2012), p. 478

1. The more people got injured, the longer the shooting stayed in the trends.

2. The more deaths, the longer the shooting stayed in the trends.

evtl. newswothiness in Kombination mit inequality


Generally, research indicates that news coverage particularly is skewed toward stories about crime Schildkraut p. 223

The first two hypotheses mainly focus on how certain crimes in this case mass shootings garner more attention from the media because they are more "newsworthy" [@someauthors]. We argued that the more people died or got injured during a mass shooting the more newsworthy the event is and the more the media reports about it. In turn this high media attention leads to an increase in public interest and the decline of search hits in Google trends on this mass shooting is less steep than for mass shootings that are not as newsworthy, do not get reported on as heavily and do not accumulate as much public interest. The next three hypotheses concentrate more on specific characteristics of mass shootings and how those could affect the decline of the relative count of search hits on this event in Google.

First, the racial or ethnic identity of the perpetrator might be an important characteristic to consider as this could heavily shape the way media presents mass shootings and the ensuing public interest in the events. Mainstream media targets mostly the white middle class in th US as the goal is to reach a larch audience. Because of this most media outlets report from a white perspective and thus "non-whites are more likely to be portrayed in a negative light relative to whites" [@Callanan2012, p. 94]  [@Tukachinsky2015, p. 187; @Wheeler2017, p. 73]. Therefore, a selection bias in media reporting in relation to race exists. Previous studies show that race explains some of the selection bias in the media. If the perpetrator in a mass shooting is not white or from another ethnicity than the majority population, the media covers the event more extensively [citations] Lundman

In line with these findings, we suggest that as non-white violators in mass shootings attract more attention from the media, this might lead to a higher interest in the event by the public. In light of the present study this higher interest in mass shootings committed by non-white violators by the broad public may manifest in a decline in hits on Google that is less steep than for events with white shooters. Hence, we expect that if the shooter is non-white or has a migration background, the decline in the relative count of search hits on the event is less steep. The third hypothesis, therefore, is:

*H3: If the shooter is black or has a migration-background, the decline in the relative count of search hits on the event is less steep.*

Another important characteristic to explain why the public interest declines slower for some mass shootings but not for others is the affluence of the area in which the shooting happens. There is not much research on the relationship between the Affluence of the area in which a mass shooting takes place and the media coverage it receives yet. However, the study by [-@Schildkraut2018, p. 235] shows that  shootings that happen in more affluent communities receive more attention from newspapers. Accordingly, we assume that mass shootings in more affluent communities are more  newsworthy and thus draw more media attention. Subsequently, the public interest in these shootings is greater and the reduction of the relative search hit count is less steep than for shootings that happen in less affluent communities. Therefore, the fourth hypothesis is:

*H4: The more affluent a community a mass shooting happens in is, the shallower is the reduction of the relative search hit count.*

As for the last hypothesis there is sparse research on how the gun laws of the state a mass shooting happens in influence its newsworthiness, media coverage and how this might affect the public interest. We expect that if a mass shooting happens in a state with weak gun laws the issue of gun control becomes more salient. Subsequently in light of this public discussion the event becomes more newsworthy and the media covers the shooting more heavily. Because of this, the public interest in the mass shooting rises and the relative count of the search hits on Google declines slower. Hence, the fifth hypothesis is:

*H5: If the state a mass shooting happens in has weak gun laws, the relative count of the search hits on Google declines slower.*

In summary, most of the previous research on mass shootings mainly focused on how certain characteristics of shootings affect its newsworthiness and its coverage in the media. Our contribution to this literature is to consider how certain characteristics of mass shootings could influence the public interest in form of the temporal decline in the relative count of search hits on this event on Google (bessere Formulierung?). Additionally we also consider characteristics of mass shootings previous studies have not considered. The focus of past research was mainly on the impact the count of dead and injured persons as well as the race of the perpetrator have on the media reporting. We also take into account how the affluence of the community where a shooting happens and the strength of the gun laws in the state a shooting takes place affect the public interest in the event. 


# Data and Variables

In order to analyze our hypotheses we combine data from Wikipedia that includes general information on mass shotings in the US with Google Trends data on the relative number of searches on Google for each event. A regression of the independent variables stated in the hypotheses on the decline of the relative search hit count on Google is conducted. This process is explained in detail in the following.

## Data from Wikipedia

First, we scraped all tables from the Wikipedia page on mass shootings in the US which are available from 2000 to 2020 [@wiki] and cleaned the data from unnecessary information. Then the scraped tables were joined into one data set and all columns that include missings were dropped as we cannot include them in a regression. The resulting table includes information about the date, the location, the count of dead persons, the count of injured persons, the total number of dead and injured persons and a description for each massshooting. 

Because we are using the data set based on the information from wikipedia later on to scrape data from google trends we created additional variables. We generated a variable with the dates fourteen days after the date of the mass shooting. This variable was subsequently used to create another variable which included both, the date of the mass shooting and the date fourteen days after the mass shooting in the required style of the Google Trends API. Furthermore, we generated a variable for the search term the Google Trends API is using to find information on the relative count of hits this keyword received in the 15 days time period. We conducted a manual search on Google Trends to find the search term for each event that received the highest number of hits in the 15 days time span for each event. Moreover, we discarded the years 2000, 2001, 2002 and 2003 as it is not possible to scrape Google Trends data before the year 2004.

After exporting this data table to excel we added three variables with information on the ethnicity of the shooter, the affluence of the area/community a shooting happened at and the strength of the gun laws for the state in which a shooting happened. These variable represent the indpendendent variables for the regression models in the analysis section additionally to the count of dead and injured persons. In order to find the necessary information on these characteristics, a online search was executed. The information on the ethnicity of the perpetrator was found on the respective Wikipedia page for each mass shooting. The variable was coded 0 if the shooter was black or had a migration background and 1 for white US Americans. The affluence of the community a mass shootings happened in was determined by a chart that depicts how the US Census Bureau breaks down income levels [@income].  .................... to be continued

Erlärung welche Daten, wie gescrapt, wie sehen die Daten aus Deskription
Tabelle mit für Missing, welche observations haben wir warum gedropped, wie viele observations verbleiben in unserem sample --> timeperiods droppen.


```{r Scraping of Wikipedia tables, results="hide"}
url <- "https://en.wikipedia.org/wiki/List_of_mass_shootings_in_the_United_States"
t <- read_html(url)
table <- t %>% html_nodes("#mw-content-text > div > table") %>% html_table(trim=T)

table

```

hier Tabellen zusammensetzten

erstes klappt, danach gibt es ein problem mit incompatiblen types. 
Ich glaube wir müssen die buchstaben aus injured rausholen damit wir es in einen integer umändern können

To Do:

- gsub loop --> alle alle nicht zahlen rausziehen
- alle mutaten damit alle integer sein 
- wenn das gemacht alle joinen zu einer großen tabelle
- in excel Extra Variablen hinzufügen
- Datum in Zahlen ändern
- zwei neue variablen, eine zwei Tage vor dem Event und 14 Tage danach
- Description den Namen herausnehmen

```{r, include = FALSE}

# Removing unnecessary expressions

for (i in 1:10) {
   table[[i]]$Injured <- gsub("[n 1]", "", table[[i]]$Injured, fixed = TRUE)
   table[[i]]$Injured <- gsub("[n 2]", "", table[[i]]$Injured, fixed = TRUE)
   table[[i]]$Injured <- gsub("[n 3]", "", table[[i]]$Injured, fixed = TRUE)
   table[[i]]$Injured <- gsub("[n 4]", "", table[[i]]$Injured, fixed = TRUE)
   table[[i]]$Injured <- gsub("[n 5]", "", table[[i]]$Injured, fixed = TRUE)
   table[[i]]$Injured <- gsub("[n 6]", "", table[[i]]$Injured, fixed = TRUE)
   table[[i]]$Injured <- gsub("[n 7]", "", table[[i]]$Injured, fixed = TRUE)
   table[[i]]$Injured <- gsub("[n 8]", "", table[[i]]$Injured, fixed = TRUE)
   table[[i]]$Injured <- gsub("[n 9]", "", table[[i]]$Injured, fixed = TRUE)
   table[[i]]$Injured <- gsub("+", "", table[[i]]$Injured, fixed = TRUE)
   table[[i]]$Dead <- gsub("[n 1]", "", table[[i]]$Dead, fixed = TRUE)
   table[[i]]$Dead <- gsub("[n 2]", "", table[[i]]$Dead, fixed = TRUE)
   table[[i]]$Dead <- gsub("[n 3]", "", table[[i]]$Dead, fixed = TRUE)
   table[[i]]$Dead <- gsub("[n 4]", "", table[[i]]$Dead, fixed = TRUE)
   table[[i]]$Dead <- gsub("[n 5]", "", table[[i]]$Dead, fixed = TRUE)
   table[[i]]$Dead <- gsub("[n 6]", "", table[[i]]$Dead, fixed = TRUE)
   table[[i]]$Dead <- gsub("[n 7]", "", table[[i]]$Dead, fixed = TRUE)
   table[[i]]$Dead <- gsub("[n 8]", "", table[[i]]$Dead, fixed = TRUE)
   table[[i]]$Dead <- gsub("[n 9]", "", table[[i]]$Dead, fixed = TRUE)
   table[[i]]$Dead <- gsub("+", "", table[[i]]$Dead, fixed = TRUE)
   table[[i]]$Total <- gsub("+", "", table[[i]]$Total, fixed = TRUE)
}


# Storing Injured, Dead and Total as numerics

for (i in 1:10) {
  as.numeric(as.character(table[[i]]$Injured))
  as.numeric(as.character(table[[i]]$Dead))
  as.numeric(as.character(table[[i]]$Total))
}


#####################################
# Date formatting not working
#dates <- table[[1]]$Date
#betterDates <- as.Date(dates,
#format = "%m %d %Y")

#table[[1]]

#for (i in 1:10) {
  #parse_date_time2("table[[i]]$Date", orders = "mdy")
  #as_date(table[[i]]$Date, tz = NULL, format = NULL)
  #as_date(table[[i]]$Date, origin = lubridate::origin)
  #c(as_date(table[[i]]$Date), as.Date(table[[i]]$Date))
#  date <- as.Date(table[[i]]$Date, format = "%B %d, %Y")
#}

#table[[1]]
####################################################

# Joining all tables to one data frame

newtab <- table[[1]]

for (i in 1:10) {
  newtab <- newtab %>% full_join(table[[i]], by = c("Date", "Location", "Dead", "Injured", "Total", "Description"))
}

newtab

# Works for simple dates, need to think about how we handle timespans --> at the moment converting them gives NAs

str(newtab$Date)

for (i in 1:10) {
   newtab$Date <- gsub(" ", "-", newtab$Date, fixed = TRUE)
   newtab$Date <- gsub(",", "", newtab$Date, fixed = TRUE)
}

newtab


#Deleting the useless part of description --> possibly need to remove year as nobody googles the year when event is happening

newtab$Description <- sub(":.*$", "", newtab$Description)
newtab
```


```{r, include = FALSE}
lct <- Sys.getlocale("LC_TIME"); Sys.setlocale("LC_TIME", "C")
newtab[["Date"]] <- as.Date(newtab$Date, format = "%B-%d-%Y")
newtab

newtab$After <- newtab$Date + 14
newtab

newtab <- na.omit(newtab)


#colnames(newtab)
newtab <- newtab[, c("Date", "After", "Location", "Dead", "Injured", "Total", "Description")] 
newtab

newtab$TrendPeriod <- paste(newtab$Date, newtab$After)
newtab

```

Erwähnen, dass wir nur nach einem Begriff suchen
Search Terms verglichen bei Trends 
Alle Events, die über Tage gehen gedropped
Sophie: 6-10 subben
Hannah: 11-15 

```{r, include = FALSE}

newtab$SearchTerm <- gsub("shootout", "shooting", newtab$Description, fixed = TRUE)

newtab <- newtab[, c("Date", "After", "TrendPeriod", "SearchTerm", "Description", "Location", "Dead", "Injured", "Total")] 

number <- c("2004", "2005", "2006", "2007", "2008", "2009", "2010", "2011", "2012", "2013", "2014", "2015", "2016", "2017", "2018", "2019")

as.character(number)

for (i in number){
   newtab$SearchTerm <- gsub(i , "", newtab$SearchTerm, fixed = TRUE)
}

newtab$SearchTerm <- gsub(" at Charlotte", "", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub("January ", "", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub(", ", " ", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub("shootings", "shooting", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub("attack", "shooting", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub("Shooting of Jemel Roberson", "Jemel Roberson shooting", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub("Fifth Third Center shooting", "Cincinatti shooting", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub("Jacksonville Landing shooting", "Jacksonville shooting", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub("Art All Night shooting", "Trenton shooting", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub("Copper Canyon Apartment Homes shooting", "Highlands Ranch shooting", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub("Rancho Tehama Reserve shooting", "Tehama shooting", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub("Sutherland Springs church shooting", "Sutherland Springs shooting", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub("Burnette Chapel shooting", "Antioch shooting", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub("Clovis library shooting", "Clovis shooting", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub("Little Rock nightclub shooting", "Little Rock shooting", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub("Bronx-Lebanon Hospital shooting", "Bronx shooting", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub("San Francisco UPS shooting", "San Francisco shooting", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub("Congressional baseball shooting", "Alexandria shooting", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub("Eaton Township Weis Markets shooting", "Weis Markets shooting", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub("Sandy Utah shooting", "Sandy shooting", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub("Orlando factory shooting", "Orlando shooting", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub("North Park Elementary School shooting", "North Park shooting", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub("Cincinnati nightclub shooting", "Cincinnati shooting", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub("Schofield/Rothschild shooting", "Rothschild shooting", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub("Fort Lauderdale airport shooting", "Fort Lauderdale shooting", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub("Townville Elementary School shooting", "Townville shooting", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub("Citronelle homicides", "Citronelle shooting", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub("shooting of Baton Rouge police officers", "Baton Rouge shooting", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub("St. Joseph courthouse shooting", "Courthouse shooting", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub("shooting of Dallas police officers", "Dallas shooting", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub("Orlando nightclub shooting", "Orlando shooting", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub("Wilkinsburg mass shooting", "Wilkinsburg shooting", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub("Colorado Springs Planned Parenthood shooting", "Planned Parenthood shooting", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub("Shooting of protesters at a Black Lives Matter protest", "Minneapolis shooting", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub("Umpqua Community College shooting", "Roseburg shooting", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub("Murders of Alison Parker and Adam Ward", "Roanoke shooting", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub("Charleston church shooting", "Charleston shooting", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub("Rosemary Anderson High School shooting", "Portland shooting", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub("Marysville Pilchuck High School shooting", "Marysville shooting", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub("Isla Vista killings", "Isla Vista shooting", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub("Ross Township Municipal Building shooting", "Ross Township shooting", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub("South Valley homicides", "South Valley shooting", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub("Sandy Hook Elementary School ()", "Sandy Hook shooting", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub("Clackamas Town Center shooting", "Clackamas shooting", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub("Azana Spa shooting", "Brookfield shooting", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub("Wisconsin Sikh temple shooting", "Oak Creek shooting", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub("Aurora Colorado movie theater shooting", "Aurora shooting", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub("Seattle cafe shooting spree", "Seattle shooting", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub("Chardon High School shooting", "Chardon School shooting", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub("Southern California Edison shooting", "Edison shooting", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub("Carson City IHOP shooting", "Carson shooting", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub("Copley Township shooting", "Copley shooting", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub("Grand Rapids mass murder", "Grand Rapids shooting", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub("Safeway Shooting in Casas Adobes Arizona ()", "Tucson shooting", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub("Hartford Beer Distributors shooting", "Manchester shooting", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub("University of Alabama in Huntsville shooting", "University of Alabama shooting", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub("ABB plant shooting", "St Louis shooting", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub("Fort Hood Military Base shooting", "Fort Hood shooting", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub("Shooting of Pittsburgh Police Officers", "Pittsburgh shooting", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub("New York immigration center shooting", "Binghampton shooting", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub("Carthage nursing home shooting", "Carthage shooting", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub("Geneva County massacre", "Geneva shooting", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub("Covina massacre", "Covina shooting", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub("Skagit County Shooting Spree ()", "Skagit Shooting", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub("Northern Illinois University shooting", "Illinois shooting", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub("Kirkwood City Council shooting", "Kirkwood shooting", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub("Lane Bryant shooting", "Tinley Park shooting", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub("Youth with a Mission and New Life Church shooting", "Colorado shooting", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub("Westroads Mall shooting ()", "Omaha shooting", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub("Crandon Wisconsin duplex shooting ()", "Crandon shooting", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub("West Nickel Mines School shooting", "Bart shooting", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub("Seattle Jewish Federation shooting", "Seattle shooting", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub("Capitol Hill massacre", "Seattle shooting", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub("Goleta postal facility shooting", "Goleta shooting", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub("Tacoma Mall shooting", "Tacoma shooting", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub("Red Lake Indian Reservation shooting", "Red Lake shooting", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub("Columbus nightclub shooting", "Columbus shooting", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub("Hunting Trip ()", "Meteor shooting", newtab$SearchTerm, fixed = TRUE)
newtab$SearchTerm <- gsub("Wesson family murders", "Fresno shooting", newtab$SearchTerm, fixed = TRUE)

newtab <- newtab[format(newtab$Date,'%Y') != "2003", ]
newtab <- newtab[format(newtab$Date,'%Y') != "2002", ]
newtab <- newtab[format(newtab$Date,'%Y') != "2001", ]
newtab <- newtab[format(newtab$Date,'%Y') != "2000", ]

newtab


```
Delisle tripple murder droppen -->> nicht genug daten
Bart shooting evtl. rausnehmen --> sieht aus als hätte es sehr kleine Fallzahlen und einen seltsamen Verlauf
Meteor shooting sieht komish aus --> evtl droppen wegen kleiner Fallzahl

```{r, include = FALSE}
# Exporting data frame to excel in order to add further variables

#Pfad Hannah
#write_xlsx(newtab,"C:\\Users\\hre\\Documents\\Uni_Mannheim\\FSS_2020\\Research_Methods_Fundamentals_of_Computing_and_Data_Display\\Paper\\Term-Paper-Fundamentals\\Fundamentals---Term-Paper-\\wikishootings2.xlsx")

#Pfad Sophie
#write_xlsx(newtab,"/Users/sophiehensgen/Term-Paper-Fundamentals/Fundamentals---Term-Paper-/WikiShootingscomplete.xlsx")
```

```{r, include = FALSE}
# Inporting excel Data 

wikishooting <- read_excel("WikiShootings_final.xlsx")
wikishooting

```

```{r, include = FALSE}
# correcting Data types

wikishooting[["Date"]] <- as.Date(wikishooting$Date, format = "%Y-%m-%d")
wikishooting[["After"]] <- as.Date(wikishooting$Date, format = "%Y-%m-%d")

wikishooting

# dropping NAs

wikishooting$Ethnicity[wikishooting$Ethnicity == "NA"] <- NA
wikishooting <- na.omit(wikishooting)

# correcting Data types

wikishooting$Ethnicity <- as.numeric(wikishooting$Ethnicity)

wikishooting$TrendPeriod <- gsub("2008-12-24 2009-01-07", "2008-12-24 2009-01-21", wikishooting$TrendPeriod, fixed = TRUE)

wikishooting <-
  wikishooting %>%
  filter(SearchTerm != "Shooting of Haynie family")

wikishooting

```

############################################################################################################################################
############################################################################################################################################
############################################################################################################################################

## Data from GTrends

Gtrends 
--> scraping von mehreren Namen auf einmal --> Text ob es mit einem funktioniert

```{r}
#shootings <- gtrends(c("Milwaukee shooting", "Grantsville shooting", "El Paso shooting"), geo = "US", time = "2012-01-01 2020-05-07", low_search_volume = T)
#plot(shootings)
#shootings
```

Versuch eines Loop der einzelne outcomes speichert
```{r, results="hide"}


#listshooting <- list()
#for (i in 1:nrow(wikishooting)){
#    x <- as.vector(wikishooting$SearchTerm[i])
#    y <- as.vector(wikishooting$TrendPeriod[i])
#    shooting <- gtrends(keyword = x, geo = "US", time = y, low_search_volume = T)
#    iteration <- (1 + length(listshooting))
#    listshooting[[iteration]] <- shooting
# }



# Beispiel wie man die einzelnen Tabellen verbindet
#massshooting <- listshooting[[1]]$interest_over_time
#for (i in 2:length(listshooting)){
#    shoot <- listshooting[[i]]$interest_over_time
#    massshooting <- rbind(massshooting, shoot)
#}
#massshooting

#saveRDS(massshooting, "massshooting.rds")

# Load the city object as city
gtrends <- readRDS("massshooting.rds")
gtrends

```

First, we transform the `data.frame` into a `tibble`.

```{r, include = FALSE}
gtrends <- as_tibble(gtrends)
glimpse(gtrends)


gtrends$keyword <- ifelse(gtrends$time == "2004-03-12 2004-03-26", 
                             gsub("Fresno shooting", "Fresno shooting 2004", gtrends$keyword, fixed = TRUE),
                             gtrends$keyword)

gtrends$keyword <- ifelse(gtrends$time == "2019-11-17 2019-12-01", 
                             gsub("Fresno shooting", "Fresno shooting 2019", gtrends$keyword, fixed = TRUE),
                             gtrends$keyword)

gtrends$keyword <- ifelse(gtrends$time == "2006-03-25 2006-04-08", 
                             gsub("Seattle shooting", "Seattle shooting March 2006", gtrends$keyword, fixed = TRUE),
                             gtrends$keyword)

gtrends$keyword <- ifelse(gtrends$time == "2006-07-28 2006-08-11", 
                             gsub("Seattle shooting", "Seattle shooting July 2006", gtrends$keyword, fixed = TRUE),
                             gtrends$keyword)

gtrends$keyword <- ifelse(gtrends$time == "2012-05-30 2012-06-13", 
                             gsub("Seattle shooting", "Seattle shooting July 2012", gtrends$keyword, fixed = TRUE),
                             gtrends$keyword)

gtrends$keyword <- ifelse(gtrends$time == "2009-11-05 2009-11-19", 
                             gsub("Fort Hood shooting", "Fort Hood shooting 2009", gtrends$keyword, fixed = TRUE),
                             gtrends$keyword)

gtrends$keyword <- ifelse(gtrends$time == "2014-04-02 2014-04-16", 
                             gsub("Fort Hood shooting", "Fort Hood shooting 2014", gtrends$keyword, fixed = TRUE),
                             gtrends$keyword)

gtrends$keyword <- ifelse(gtrends$time == "2017-03-26 2017-04-09", 
                             gsub("Cincinnati shooting", "Cincinnati shooting 2017", gtrends$keyword, fixed = TRUE),
                             gtrends$keyword)

gtrends$keyword <- ifelse(gtrends$time == "2018-09-06 2018-09-20", 
                             gsub("Cincinnati shooting", "Cincinnati shooting 2018", gtrends$keyword, fixed = TRUE),
                             gtrends$keyword)

gtrends$keyword <- ifelse(gtrends$time == "2014-07-09 2014-07-23", 
                             gsub("Harris County shooting", "Harris County shooting 2014", gtrends$keyword, fixed = TRUE),
                             gtrends$keyword)

gtrends$keyword <- ifelse(gtrends$time == "2015-08-08 2015-08-22", 
                             gsub("Harris County shooting", "Harris County shooting 2015", gtrends$keyword, fixed = TRUE),
                             gtrends$keyword)

gtrends$keyword <- ifelse(gtrends$time == "2016-06-12 2016-06-26", 
                             gsub("Orlando shooting", "Orlando shooting 2016", gtrends$keyword, fixed = TRUE),
                             gtrends$keyword)

gtrends$keyword <- ifelse(gtrends$time == "2017-06-05 2017-06-19", 
                             gsub("Orlando shooting", "Orlando shooting 2017", gtrends$keyword, fixed = TRUE),
                             gtrends$keyword)


gtrends$hits <- gsub("<1", "0", gtrends$hits, fixed = TRUE)


gtrends <- gtrends[-c(271:284), ]

gtrends


```


```{r, include = FALSE}

gtrends$rownumber = 1:15

gtrends$hits <- as.numeric(as.character(gtrends$hits))

reg <-
  gtrends %>%
  group_by(keyword) %>%            # group by column z
  do(tidy(lm(hits ~ rownumber, data=.)))

reg 

reg <- subset(reg, term=="rownumber")

reg

#write_xlsx(reg,"C:\\Users\\hre\\Documents\\Uni_Mannheim\\FSS_2020\\Research_Methods_Fundamentals_of_Computing_and_Data_Display\\Paper\\Term-Paper-Fundamentals\\Fundamentals---Term-Paper-\\reg.xlsx")

gtrends

wikishooting <-
  wikishooting %>%
  arrange(SearchTerm)

wikishooting

#write_xlsx(wikishooting,"C:\\Users\\hre\\Documents\\Uni_Mannheim\\FSS_2020\\Research_Methods_Fundamentals_of_Computing_and_Data_Display\\Paper\\Term-Paper-Fundamentals\\Fundamentals---Term-Paper-\\wikialph.xlsx")

Final <- cbind(wikishooting, coef = reg$estimate) 

Final


# Versuch Regression mit einer observation

#gtrends_Columbus <- subset(gtrends, keyword == "Columbus shooting")
#gtrends_Columbus

#gtrends_Columbus$rownumber = 1:nrow(gtrends_Columbus)
#gtrends_Columbus

#reg <- lm(hits ~ rownumber, data = gtrends_Columbus, )

#coef <- summary(reg)$coefficients[2]
#coef

#gtrends_Columbus$coef = coef
#gtrends_Columbus
```



############################################################################################################################################
############################################################################################################################################
############################################################################################################################################


## Method 


Sophie



############################################################################################################################################
############################################################################################################################################
############################################################################################################################################

# Results

Hannah: Descriptives: Barplots of variables mit facet wrap we
##########################################################


Wie sollten vllt. Gender of shooter kontrollieren. Frauen werden in den Medien mehr beachtet --> Könnte zu einer Verzerrung der Ergebnisse führen.

Sophie: Scatterplot von unabhängigen Variablen und der Abnahme für jede IV --> evtl. geom point + geom smooth
############################################################

Regressionstabelle aufhübschen + alle Modelle inkludieren
#####################################################

Sophie: Plot Regressionsgeraden des vollen Modells
##########################################

Hannah: Coefplot oder Marginsplot für volles Modell
############################################

```{r}
# Regression 

regdead <- lm(coef ~ Dead, data = Final, )
summary(regdead)

reginjured = lm(coef ~ Injured, data = Final, )
summary(reginjured)

regeth <- lm(coef ~ Ethnicity, data = Final, )
summary(regeth)

reggun <- lm(coef ~ Gunlaws, data = Final, )
summary(reggun)

regarea <- lm(coef ~ Area, data = Final, )
summary(regarea)

regtotal <- lm(coef ~ Total, data = Final, )
summary(regtotal)


regfull = lm(coef ~ Dead + Injured + Ethnicity + Area + Gunlaws, data = Final, )
summary(regfull)


library(sjPlot)
tab_model(regdead,regfull, file="output.html")




#library(lattice)
#library(MASS)
#library(memisc)
#library(pander)
#regtable <- mtable('Model 1' = regdead,
#            'Model 2' = reginjured,
#            'Model 3' = regfull,
#            summary.stats = c('R-squared','F','p','N'))


#pander(regtable)

pander(regfull)
#install.packages("stargazer") 
library(stargazer)
regdead <- lm(coef ~ Dead, data = Final, )
regfull <- lm(coef ~ Dead + Injured + Ethnicity + Area + Gunlaws, data = Final, )


```

```{r, results='asis'}
# If output: pdf_document
#stargazer(regdead, regfull, type = "text", 
 #         title            = "These are awesome results!",
  #        covariate.labels = c("Dead", "Injured", "Ethnicity",
   #                            "Area", "Gunlaws"),
    #      dep.var.labels   = "decrease of interest", 
     #     float.env = "sidewaystable", 
      #    keep.stat = "adj.rsq")

stargazer::stargazer(regdead, regfull, regeth, title   = "These are awesome results!", 
                     covariate.labels = c("Dead", "Injured", "Ethnicity","Area", "Gunlaws"), 
                     dep.var.labels   = "decrease of interest", 
                     keep.stat = "adj.rsq", "n",
                     flip = TRUE)
                     
#, float.env = "sidewaystable", keep.stat = "adj.rsq", title = "Table with stargazer")

```





Hannah Ab Regression Table 








Hannah Ab Regression Table 




# Conclusion 
Hannah


# References






